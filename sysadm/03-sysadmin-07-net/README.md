
## Домашнее задание к занятию "3.7. Компьютерные сети, лекция 2"

1.

Linux

```bash
root@vagrant:~# ip -c -br link
lo               UNKNOWN        00:00:00:00:00:00 <LOOPBACK,UP,LOWER_UP>
eth0             UP             08:00:27:a2:6b:fd <BROADCAST,MULTICAST,UP,LOWER_UP>
```

```bash
root@vagrant:~# netstat -i
Kernel Interface table
Iface      MTU    RX-OK RX-ERR RX-DRP RX-OVR    TX-OK TX-ERR TX-DRP TX-OVR Flg
eth0      1500   201107      0      0 0         86376      0      0      0 BMRU
lo       65536      490      0      0 0           490      0      0      0 LRU
```

```bash
root@vagrant:~# sudo nmcli device show | grep GENERAL.DEVICE
GENERAL.DEVICE:                         eth0
GENERAL.DEVICE:                         lo
```

Windows

```bash
PS C:\Users\Note> ipconfig

Настройка протокола IP для Windows


Адаптер Ethernet Ethernet:

   Состояние среды. . . . . . . . : Среда передачи недоступна.
   DNS-суффикс подключения . . . . . :

Неизвестный адаптер OpenVPN Wintun:

   Состояние среды. . . . . . . . : Среда передачи недоступна.
   DNS-суффикс подключения . . . . . :

Неизвестный адаптер Подключение по локальной сети:

   Состояние среды. . . . . . . . : Среда передачи недоступна.
   DNS-суффикс подключения . . . . . :

Адаптер Ethernet VirtualBox Host-Only Network:

   DNS-суффикс подключения . . . . . :
   Локальный IPv6-адрес канала . . . : fe80::54ac:5b61:b19b:6170%5
   IPv4-адрес. . . . . . . . . . . . : 192.168.56.1
   Основной шлюз. . . . . . . . . :

Неизвестный адаптер OpenVPN TAP-Windows6:

   Состояние среды. . . . . . . . : Среда передачи недоступна.
   DNS-суффикс подключения . . . . . :

Адаптер беспроводной локальной сети Подключение по локальной сети* 9:

   Состояние среды. . . . . . . . : Среда передачи недоступна.
   DNS-суффикс подключения . . . . . :

Адаптер беспроводной локальной сети Подключение по локальной сети* 10:

   Состояние среды. . . . . . . . : Среда передачи недоступна.
   DNS-суффикс подключения . . . . . :

Адаптер беспроводной локальной сети Беспроводная сеть:

   DNS-суффикс подключения . . . . . : Home
   Локальный IPv6-адрес канала . . . : fe80::ec2b:2d28:fc6c:5cbc%6
   IPv4-адрес. . . . . . . . . . . . : 192.168.1.8
   Маска подсети . . . . . . . . . . : 255.255.255.0
   Основной шлюз. . . . . . . . . : 192.168.1.1
```

```bash
PS C:\Users\Note> netsh interface ip show interfaces

Инд     Мет         MTU          Состояние               Имя
---  ----------  ----------  ------------  ---------------------------
  1          75  4294967295  connected     Loopback Pseudo-Interface 1
 20           5       65535  disconnected  OpenVPN Wintun
  6          50        1500  connected     Беспроводная сеть
  9          25        1500  disconnected  OpenVPN TAP-Windows6
  3          25        1500  disconnected  Подключение по локальной сети* 9
 18          15        1500  disconnected  Подключение по локальной сети
 13          25        1500  disconnected  Подключение по локальной сети* 10
 17           5        1500  disconnected  Ethernet
  5          25        1500  connected     VirtualBox Host-Only Network
```

```bash
PS C:\Users\Note> Get-NetIPInterface

ifIndex InterfaceAlias                  AddressFamily NlMtu(Bytes) InterfaceMet
                                                                            ric
------- --------------                  ------------- ------------ ------------
5       VirtualBox Host-Only Network    IPv6                  1500           25
17      Ethernet                        IPv6                  1500            5
13      Подключение по локальной сет... IPv6                  1500           25
18      Подключение по локальной сети   IPv6                  1500           15
3       Подключение по локальной сет... IPv6                  1500           25
9       OpenVPN TAP-Windows6            IPv6                  1500           25
6       Беспроводная сеть               IPv6                  1500           50
20      OpenVPN Wintun                  IPv6                 65535            5
1       Loopback Pseudo-Interface 1     IPv6            4294967295           75
5       VirtualBox Host-Only Network    IPv4                  1500           25
17      Ethernet                        IPv4                  1500            5
13      Подключение по локальной сет... IPv4                  1500           25
18      Подключение по локальной сети   IPv4                  1500           15
3       Подключение по локальной сет... IPv4                  1500           25
9       OpenVPN TAP-Windows6            IPv4                  1500           25
6       Беспроводная сеть               IPv4                  1500           50
20      OpenVPN Wintun                  IPv4                 65535            5
1       Loopback Pseudo-Interface 1     IPv4            4294967295           75
```

2.

**LLDP** – протокол для обмена информацией между соседними устройствами,
позволяет определить к какому порту коммутатора подключен сервер.

Для этого используется пакет  `lldpd`. Команда `lldpctl`.

3.

Используется технология _VLAN_.
**VLAN (Virtual Local Area Network)** — группа устройств, имеющих возможность взаимодействовать между собой напрямую на
канальном уровне, хотя физически при этом они могут быть подключены к разным сетевым коммутаторам. И наоборот,
устройства, находящиеся в разных VLAN'ах, невидимы друг для друга на канальном уровне, даже если они подключены к одному
коммутатору, и связь между этими устройствами возможна только на сетевом и более высоких уровнях.

Для того чтобы информация о созданных VLAN'ах сохранилась после перезагрузки, необходимо добавить её в
файл `/etc/network/interfaces`.
Например:

```bash
auto eth0.1400
iface eth0.1400 inet static
        address 192.168.1.1
        netmask 255.255.255.0
        vlan_raw_device eth0
```

Номер 1400 в данном случае указывает на то, какой **VLAN ID** должен использоваться.

Вручную, так же, как и в любом дистрибутиве Linux, настройка **VLAN** выполняется с помощью программы `vconfig`.
Независимо от того, настраивается **VLAN** при загрузке скрипта, обрабатывающими `/etc/network/interfaces`, своими
собственными скриптами или вручную, использование **VLAN** в Ubuntu требует установленного пакета `vlan`, содержащего
утилиту
`vconfig`.

4.

**Агрегирование каналов** (агрегация каналов, англ. link aggregation) — технология, которая позволяет объединить
несколько физических каналов в один логический. Такое объединение позволяет увеличивать пропускную способность и
надежность канала. Агрегирование каналов может быть настроено между двумя коммутаторами, коммутатором и
маршрутизатором, между коммутатором и хостом.

**Типы LAG:**

* статический; Статическое агрегирование без использования протоколов
* динамический – LACP-протокол, PAgP-протокол.

Пример конфигурационного файла:

```bash
auto bond0
iface bond0 inet static
    bond-slaves wlan0 eth0
    bond-mode active-backup
    bond-primary eth0
    bond-miimon 100
    address <ipv4address>/<maskbits>
    gateway <ipv4address>

allow-bond0 eth0
iface eth0 inet manual

allow-bond0 wlan0
iface wlan0 inet manual
#    bond-give-a-chance 10
    wpa-bridge bond0
    wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf
```

**Балансировка нагрузки**

Метод балансировки нагрузки повлияет на распределение трафика во всех EtherChannel, которые созданы на коммутаторе.
В зависимости от модели коммутатора, могут поддерживаться такие методы балансировки:

1. по MAC-адресу отправителя или MAC-адресу получателя или учитывая оба адреса
2. по IP-адресу отправителя или IP-адресу получателя или учитывая оба адреса
3. по номеру порта отправителя или номеру порта получателя или учитывая оба порта

Пример вариантов на коммутаторе 3560:

```bash
sw1(config)# port-channel load-balance ?
dst-ip Dst IP Addr
dst-mac Dst Mac Addr
src-dst-ip Src XOR Dst IP Addr
src-dst-mac Src XOR Dst Mac Addr
src-ip Src IP Addr
src-mac Src Mac Addr
```

При выборе метода балансировки, необходимо учитывать топологию сети, каким образом передается трафик.

5. В сети 10.0.0.0/29 - 6 адресов

```bash
root@vagrant:~# ipcalc 10.0.0.0/29
Address:   10.0.0.0             00001010.00000000.00000000.00000 000
Netmask:   255.255.255.248 = 29 11111111.11111111.11111111.11111 000
Wildcard:  0.0.0.7              00000000.00000000.00000000.00000 111
=>
Network:   10.0.0.0/29          00001010.00000000.00000000.00000 000
HostMin:   10.0.0.1             00001010.00000000.00000000.00000 001
HostMax:   10.0.0.6             00001010.00000000.00000000.00000 110
Broadcast: 10.0.0.7             00001010.00000000.00000000.00000 111
Hosts/Net: 6                     Class A, Private Internet
```

Из сети с маской /24 можно получить 32 подсети /29:

```bash
root@vagrant:~# ipcalc 10.10.10.0/24 29
Address:   10.10.10.0           00001010.00001010.00001010. 00000000
Netmask:   255.255.255.0 = 24   11111111.11111111.11111111. 00000000
Wildcard:  0.0.0.255            00000000.00000000.00000000. 11111111
=>
Network:   10.10.10.0/24        00001010.00001010.00001010. 00000000
HostMin:   10.10.10.1           00001010.00001010.00001010. 00000001
HostMax:   10.10.10.254         00001010.00001010.00001010. 11111110
Broadcast: 10.10.10.255         00001010.00001010.00001010. 11111111
Hosts/Net: 254                   Class A, Private Internet

Subnets after transition from /24 to /29

Netmask:   255.255.255.248 = 29 11111111.11111111.11111111.11111 000
Wildcard:  0.0.0.7              00000000.00000000.00000000.00000 111

 1.
Network:   10.10.10.0/29        00001010.00001010.00001010.00000 000
HostMin:   10.10.10.1           00001010.00001010.00001010.00000 001
HostMax:   10.10.10.6           00001010.00001010.00001010.00000 110
Broadcast: 10.10.10.7           00001010.00001010.00001010.00000 111
Hosts/Net: 6                     Class A, Private Internet

 2.
Network:   10.10.10.8/29        00001010.00001010.00001010.00001 000
HostMin:   10.10.10.9           00001010.00001010.00001010.00001 001
HostMax:   10.10.10.14          00001010.00001010.00001010.00001 110
Broadcast: 10.10.10.15          00001010.00001010.00001010.00001 111
Hosts/Net: 6                     Class A, Private Internet

.........

  32.
Network:   10.10.10.248/29      00001010.00001010.00001010.11111 000
HostMin:   10.10.10.249         00001010.00001010.00001010.11111 001
HostMax:   10.10.10.254         00001010.00001010.00001010.11111 110
Broadcast: 10.10.10.255         00001010.00001010.00001010.11111 111
Hosts/Net: 6                     Class A, Private Internet


Subnets:   32
Hosts:     192
```

6.

К частным "серым" адресам относятся IP-адреса в том числе:
100.64.0.0 до 100.127.255.255 с маской подсети 255.192.0.0 или /10;
данная подсеть рекомендована согласно rfc6598 для использования в качестве адресов для CGN (Carrier-Grade NAT)

```bash
root@vagrant:~# ipcalc 100.64.0.0/10 -s 50
Address:   100.64.0.0           01100100.01 000000.00000000.00000000
Netmask:   255.192.0.0 = 10     11111111.11 000000.00000000.00000000
Wildcard:  0.63.255.255         00000000.00 111111.11111111.11111111
=>
Network:   100.64.0.0/10        01100100.01 000000.00000000.00000000
HostMin:   100.64.0.1           01100100.01 000000.00000000.00000001
HostMax:   100.127.255.254      01100100.01 111111.11111111.11111110
Broadcast: 100.127.255.255      01100100.01 111111.11111111.11111111
Hosts/Net: 4194302               Class A

1. Requested size: 50 hosts
Netmask:   255.255.255.192 = 26 11111111.11111111.11111111.11 000000
Network:   100.64.0.0/26        01100100.01000000.00000000.00 000000
HostMin:   100.64.0.1           01100100.01000000.00000000.00 000001
HostMax:   100.64.0.62          01100100.01000000.00000000.00 111110
Broadcast: 100.64.0.63          01100100.01000000.00000000.00 111111
Hosts/Net: 62                    Class A

Needed size:  64 addresses.
Used network: 100.64.0.0/26
Unused:
100.64.0.64/26
100.64.0.128/25
100.64.1.0/24
100.64.2.0/23
100.64.4.0/22
100.64.8.0/21
100.64.16.0/20
100.64.32.0/19
100.64.64.0/18
100.64.128.0/17
100.65.0.0/16
100.66.0.0/15
100.68.0.0/14
100.72.0.0/13
100.80.0.0/12
100.96.0.0/11
```

пример - 100.64.0.1

7.

**Linux**

Посмотреть таблицы:

```bash
root@vagrant:~# ip neigh
10.0.2.2 dev eth0 lladdr 52:54:00:12:35:02 DELAY
10.0.2.3 dev eth0 lladdr 52:54:00:12:35:03 REACHABLE
```

Удалить один адрес:

```bash
ip neigh del {IP} dev {DEVICE}
```

очистка ARP таблицы:

```bash
ip neigh flush all
```

**Windows**

Просмотр:

```bash
arp -a
```

Удаление одного адреса:

```bash
arp -d 10.0.2.2
```

Очистка arp-кэша:

```bash
netsh interface ip delete arpcache
```
